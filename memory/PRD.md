# Voice Workspace — PRD

## Original Problem Statement
Приложение для транскрибации аудио/видео встреч с AI-обработкой и разметкой спикеров.

## Core Requirements
1. Автоматическая транскрибация (Deepgram)
2. AI-анализ встреч через OpenAI GPT
3. Разметка спикеров
4. Справочник спикеров
5. Конструктор сценариев анализа (визуальный, React Flow)
6. Пошаговое исполнение сценариев

## Architecture
- **Backend:** FastAPI + MongoDB + Pydantic
- **Frontend:** React + Tailwind + Shadcn/UI + React Flow (@xyflow/react)
- **AI:** OpenAI GPT (Emergent LLM Key)
- **Transcription:** Deepgram

## What's Been Implemented

### Транскрибация и спикеры
- [x] Загрузка и транскрибация аудио/видео
- [x] Разметка спикеров на вкладке Транскрипт
- [x] Справочник спикеров с парсингом "Имя (Компания)"
- [x] AI-обработка с подстановкой полных имён

### Конструктор сценариев анализа (Dec 2025)
- [x] CRUD API для пайплайнов
- [x] Визуальный редактор на React Flow
- [x] 7 типов узлов: ai_prompt, parse_list, batch_loop, aggregate, template, user_edit_list, user_review
- [x] Два типа стрелок: порядок выполнения (серые) и источники данных (оранжевые пунктирные)
- [x] Хэндлы на всех 4 сторонах блоков, скрыты при отсутствии наведения
- [x] Ортогональная маршрутизация стрелок (smoothstep)
- [x] Undo/Redo + горячие клавиши
- [x] Скрипты для всех типов узлов-обработчиков (с реальным кодом из мастер-анализа)
- [x] AI-помощник для генерации скриптов (POST /api/ai/generate-script)
- [x] Режим "Предпросмотр" — пошаговый визард из конструктора
- [x] Дефолтный пайплайн "Стандартный анализ встречи"

## Prioritized Backlog

### P0
- [ ] Движок исполнения пайплайна в проекте (рефакторинг FullAnalysisTab)
- [ ] Выбор сценария при запуске мастер-анализа

### P1
- [ ] Интеграция с библиотекой промптов (prompt_id в узлах)
- [ ] Создание промптов из конструктора

### P2
- [ ] condition (ветвление)
- [ ] extract_json
- [ ] merge (параллельные ветки)
